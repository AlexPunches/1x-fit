# Архитектурное решение для Telegram-бота соревнования по снижению веса

## Общее описание

Telegram-бот для соревнования по снижению веса, где участники регистрируются и ежедневно отслеживают свой прогресс. Бот собирает данные о весе и количестве шагов, сохраняет их в базу данных и визуализирует прогресс участников.

## Компоненты системы

### 1. Telegram-бот (aiogram)
- Обработка команд и сообщений пользователей
- Регистрация новых участников
- Ежедневные опросы (вес в 10:00, шаги в 22:00)
- Отображение прогресса участников

### 2. Система уведомлений
- Планировщик задач (schedule) для отправки ежедневных опросов
- Напоминания об отсутствии ответов

### 3. База данных (SQLite)
- Хранение информации о пользователях
- Хранение исторических данных о весе и шагах
- Таблицы: users, weight_records, step_records

### 4. Система расчета прогресса
- Алгоритм пересчета прогресса с учетом ИМТ и индивидуальных особенностей
- Формула справедливого сравнения прогресса участников

### 5. Система визуализации
- Генерация графиков прогресса участников
- Отображение текущего положения участников в соревновании

## Структура базы данных

### Таблица users
- id (INTEGER PRIMARY KEY) - ID пользователя в Telegram
- username (TEXT) - Ник участника
- gender (TEXT) - Пол (M/F)
- age (INTEGER) - Возраст
- height (REAL) - Рост в см
- start_weight (REAL) - Стартовый вес
- target_weight (REAL) - Целевой вес
- registration_date (TEXT) - Дата регистрации

### Таблица weight_records
- id (INTEGER PRIMARY KEY)
- user_id (INTEGER) - Ссылка на пользователя
- weight (REAL) - Вес
- record_date (TEXT) - Дата записи
- FOREIGN KEY(user_id) REFERENCES users(id)

### Таблица step_records
- id (INTEGER PRIMARY KEY)
- user_id (INTEGER) - Ссылка на пользователя
- steps_count (INTEGER) - Количество шагов
- record_date (TEXT) - Дата записи
- FOREIGN KEY(user_id) REFERENCES users(id)

## Система уведомлений и опросов

### Расписание опросов
- Ежедневно в 10:00 - запрос текущего веса
- Ежедневно в 22:00 - запрос количества шагов
- Возможность добавления дополнительных опросов через конфигурацию

### Механизм опросов
- Отправка сообщений с клавиатурой для быстрого ответа
- Обработка ответов и сохранение в базу данных
- Напоминания о пропущенных ответах

## Формула расчета прогресса

Для справедливого сравнения прогресса участников будем использовать модифицированную систему, учитывающую:

1. Индекс массы тела (ИМТ) - отношение веса к росту в квадрате
2. Процент снижения от начального веса
3. Адаптивную шкалу прогресса, где каждая единица требует разного количества килограммов в зависимости от текущего состояния участника

Формула будет учитывать, что при более высоком начальном весе первые килограммы сбрасываются легче, и по мере приближения к целевому весу прогресс замедляется.

## Визуализация прогресса

### График прогресса
- Для каждого участника отдельная точка на графике
- Ось X - прогресс в условных пунктах (от 0 до достижения цели)
- Отсутствие временной шкалы - позиция участника отражает текущий прогресс, а не время
- Каждый участник имеет индивидуальную шкалу прогресса, зависящую от его параметров
- Точка участника может двигаться как вправо (снижение веса), так и влево (увеличение веса)
- Метки над точками показывают количество сброшенных/набранных кг

### Интерактивность
- Возможность выбора отображения участников
- Отображение детальной информации при наведении на точки
- Цветовое кодирование для лучшего восприятия (зеленый - прогресс, красный - регресс)

## Технические требования

- Python 3.13
- aiogram 3.x для работы с Telegram Bot API
- SQLite для хранения данных
- matplotlib/seaborn для визуализации графиков
- schedule для планирования задач
- python-dotenv для управления конфигурацией