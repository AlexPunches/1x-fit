# Формула расчета прогресса с учетом ИМТ и индивидуальных особенностей

## Обоснование необходимости адаптивной системы оценки

При стандартном подходе, где просто считается количество сброшенных килограммов, возникает несправедливость:
- Участник с изначально большим весом может сбросить больше килограммов, но при этом приложить меньшие усилия
- Участник с меньшим изначальным весом может сбросить меньше килограммов, но приложить больше усилий

Поэтому необходима система, которая учитывает индивидуальные особенности каждого участника.

## Медицинские основы: Индекс массы тела (ИМТ)

ИМТ рассчитывается по формуле:
```
ИМТ = вес (кг) / (рост (м))²
```

Нормальный диапазон ИМТ: 18.5 - 24.9

## Предлагаемая формула расчета прогресса

### Шаг 1: Расчет начального ИМТ
```
initial_bmi = start_weight / (height / 100)²
```

### Шаг 2: Расчет текущего ИМТ
```
current_bmi = current_weight / (height / 100)²
```

### Шаг 3: Определение прогресса в ИМТ
```
bmi_improvement = initial_bmi - current_bmi
```

### Шаг 4: Нормировка прогресса

Для справедливого сравнения между участниками с разным начальным ИМТ, используем нормировку:

```
progress_score = bmi_improvement * weight_factor
```

Где `weight_factor` - коэффициент, зависящий от начального ИМТ:
- Если initial_bmi < 25 (нормальный вес), weight_factor = 1.0
- Если initial_bmi >= 25 и < 30 (избыточный вес), weight_factor = 1.2
- Если initial_bmi >= 30 (ожирение 1 степени), weight_factor = 1.5
- Если initial_bmi >= 35 (ожирение 2 степени), weight_factor = 1.8
- Если initial_bmi >= 40 (ожирение 3 степени), weight_factor = 2.0

### Шаг 5: Адаптивная шкала прогресса

Для реализации идеи, что "чем худее становится участник, тем меньше количества сброшенных килограммов нужно чтобы пройти один пункт", будем использовать адаптивную шкалу:

```
adaptive_factor = max(0.5, 1.0 - (current_bmi - target_bmi) / (initial_bmi - target_bmi))
points_for_kg = base_points_for_kg * adaptive_factor
```

Где:
- `base_points_for_kg` - базовое количество очков за 1 кг
- `adaptive_factor` - коэффициент, который уменьшается по мере приближения к цели

### Шаг 6: Итоговая формула

Объединяя все элементы, получаем:

```
progress_points = Σ((weight_loss_in_kg_i) * points_for_kg_i)
```

Где суммирование происходит по всем записям веса, и `points_for_kg_i` рассчитывается для каждой точки на основе текущего ИМТ на момент сброса веса.

## Альтернативный подход: Процентное снижение веса с коррекцией

Другой вариант формулы:
```
percentage_loss = (start_weight - current_weight) / start_weight * 100
adjusted_percentage = percentage_loss * adjustment_factor
```

Где `adjustment_factor` зависит от начального ИМТ:
```
if initial_bmi < 25:
    adjustment_factor = 1.0
elif initial_bmi < 30:
    adjustment_factor = 1.1
elif initial_bmi < 35:
    adjustment_factor = 1.3
elif initial_bmi < 40:
    adjustment_factor = 1.6
else:
    adjustment_factor = 2.0
```

## Выбор окончательной формулы

Для реализации рекомендуется использовать комбинацию обоих подходов:

```
final_score = (bmi_based_score * 0.6) + (percentage_based_score * 0.4)
```

Где:
- `bmi_based_score` - результат по формуле на основе ИМТ
- `percentage_based_score` - результат по формуле на основе процентного снижения

ВАЖНО: Формула должна учитывать возможность как снижения, так и увеличения веса:
- При снижении веса: положительный прогресс (движение вправо по графику)
- При увеличении веса: отрицательный прогресс (движение влево по графику)

## Пример расчета

Допустим, у нас есть два участника:

Участник A:
- Рост: 180 см
- Начальный вес: 75 кг
- ИМТ: 23.1
- Целевой вес: 70 кг

Участник B:
- Рост: 160 см
- Начальный вес: 100 кг
- ИМТ: 39.1
- Целевой вес: 80 кг

После потери 5 кг:

Участник A:
- Новый вес: 70 кг
- Новый ИМТ: 21.6
- BMI improvement: 1.5
- Progress score: 1.5 * 1.0 = 1.5
- Позиция на графике: +1.5 условных единиц (движение вправо)

Участник B:
- Новый вес: 95 кг
- Новый ИМТ: 37.1
- BMI improvement: 2.0
- Progress score: 2.0 * 2.0 = 4.0
- Позиция на графике: +4.0 условных единиц (движение вправо)

Если участник набирает вес:
- Участник теряет 2 очка прогресса (движение влево по графику)
- На графике отображается как отрицательное значение (например, -2кг)

Таким образом, участник B получает больше очков за те же 5 кг, что отражает большую сложность начального состояния, и система позволяет отслеживать как прогресс (движение вправо), так и регресс (движение влево).

## Реализация в системе

Для каждого участника система будет:
1. Рассчитывать текущий прогресс при каждом новом вводе веса
2. Сохранять значения прогресса в отдельной таблице
3. Использовать эти значения для построения графиков и определения позиций в соревновании
4. Отображать на графике как положительное (вправо), так и отрицательное (влево) движение
5. Показывать метки с фактическим количеством сброшенных/набранных кг

Все вычисления будут реализованы с использованием возможностей Python 3.13, включая современные математические библиотеки и оптимизированные алгоритмы для точных расчетов.